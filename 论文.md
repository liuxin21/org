## match density

![Screenshot 2017-11-23 14.32.30](https://i.imgur.com/la1Rwe3.png)

$$
\mu_{i,j}^{n+1} =
\lambda \left[ \frac{1}{L^2}(\phi_{i,j}^{n3} - \phi_{i,j}^n) - 
(\frac{\phi_{i+1,j}^{n+1}-2\phi_{i,j}^{n+1}+\phi_{i-1,j}^{n+1}}{\Delta x ^2}+
\frac{\phi_{i,j+1}^{n+1}-2\phi_{i,j}^{n+1}+\phi_{i,j-1}^{n+1}}{\Delta y ^2})\right] + 
\frac{\lambda}{L^2} (\phi^{n+1}_{i,j} - \phi^{n+1}_{i,j})
$$

$$\phi_{i,j}^{n+1} = 
\phi_{i,j}^{n} - 
\frac{\Delta t}{2\Delta x} \tilde{u}_{i,j}^{n+1}(\phi_{i+1,j}^{n}-\phi_{i-1,j}^{n}) - 
\frac{\Delta t}{2\Delta y}\tilde v_{i,j}^{n+1}(\phi_{i,j+1}^{n}-\phi_{i,j-1}^{n})
$$

$$
+m \Delta t \left(\frac{\mu_{i+1,j}^{n+1}-2\mu_{i,j}^{n+1}+\mu_{i-1,j}^{n+1}}{\Delta x^2}\right.
+\left.\frac{\mu_{i,j+1}^{n+1}-2\mu_{i,j}^{n+1}+\mu_{i,j-1}^{n+1}}{\Delta y^2}\right)
$$
$$
\tilde{u}_{i,j}^{n+1} -
u_{i,j}^{n} + 
\frac{\Delta t}{2\Delta x} u_{i,j}^{n} (u_{i+1,j}^{n}-u_{i-1,j}^{n}) +
\frac{\Delta t}{2\Delta y} v_{i,j}^{n} (u_{i,j+1}^{n}-u_{i,j-1}^{n})
$$

$$
= \frac{\Delta t}{Re}\left(\frac{u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n}}{\Delta x^2}\right.
+\left.\frac{u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n}}{\Delta y^2}\right) + \frac{\Delta t}{Re\cdot Ca} \mu_{i,j} \left(\frac{\phi_{i+1,j}-\phi_{i-1,j}}{2\Delta x}\right) 
$$

# Step1, $u^n$,$v^n$,$\phi^n$,$\mu^n$ => $u_{i,j}^{n+\frac12}$, $v_{i,j}^{n+\frac12}$:

$$
\frac{u_{i,j}^{n+\frac12}-u_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{u_{i+1,j}^{n}-u_{i-1,j}^{n}}{2\Delta x}+v_{i,j}^{n}\frac{u_{i,j+1}^{n}-u_{i,j-1}^{n}}{2\Delta y} =\frac{1}{Re} \left(\frac{u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n}}{\Delta x^2}+\frac{u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n}}{\Delta y^2}\right) + \frac{1}{Re\cdot Ca} \mu_{i,j} \left(\frac{\phi_{i+1,j}-\phi_{i-1,j}}{2\Delta x}\right) 
$$

$$
\frac{v_{i,j}^{n+\frac12}-v_{i,j}^{n}}{\Delta t}+u_{i,j}^{n}\frac{v_{i+1,j}^{n}-v_{i-1,j}^{n}}{2\Delta x}+v_{i,j}^{n}\frac{v_{i,j+1}^{n}-v_{i,j-1}^{n}}{2\Delta y} = \frac{1}{Re} \left(\frac{v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n}}{\Delta x^2}+\frac{v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n}}{\Delta y^2}\right) + \frac{1}{Re\cdot Ca} \mu_{i,j} \left(\frac{\phi_{i,j+1}-\phi_{i,j-1}}{2\Delta y}\right) 
$$

$$
u_{i,j}^{n+\frac12} = u_{i,j}^{n} - u_{i,j}^{n}\frac{\Delta t}{2\Delta x}(u_{i+1,j}^{n}-u_{i-1,j}^{n}) - v_{i,j}^{n}\frac{\Delta t}{2\Delta y}(u_{i,j+1}^{n}-u_{i,j-1}^{n})
+\frac{\Delta t}{Re}\left(\frac{u_{i+1,j}^{n}-2u_{i,j}^{n}+u_{i-1,j}^{n}}{\Delta x^2}\right.
+\left.\frac{u_{i,j+1}^{n}-2u_{i,j}^{n}+u_{i,j-1}^{n}}{\Delta y^2}\right) + \frac{\Delta t}{Re\cdot Ca} \mu_{i,j} \left(\frac{\phi_{i+1,j}-\phi_{i-1,j}}{2\Delta x}\right) 
$$

$$v_{i,j}^{n+\frac12} = v_{i,j}^{n}-u_{i,j}^{n}\frac{\Delta t}{2\Delta x}(v_{i+1,j}^{n}-v_{i-1,j}^{n}) - v_{i,j}^{n}\frac{\Delta t}{2\Delta y}(v_{i,j+1}^{n}-v_{i,j-1}^{n}) +\frac{\Delta t}{Re}\left(\frac{v_{i+1,j}^{n}-2v_{i,j}^{n}+v_{i-1,j}^{n}}{\Delta x^2}\right. 
+\left.\frac{v_{i,j+1}^{n}-2v_{i,j}^{n}+v_{i,j-1}^{n}}{\Delta y^2}\right) + \frac{\Delta t}{Re\cdot Ca} \mu_{i,j}\left(\frac{\phi_{i,j+1}-\phi_{i,j-1}}{2\Delta y}\right) $$





